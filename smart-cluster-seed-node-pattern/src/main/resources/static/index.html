<!doctype html>
<html lang="en">
    <head>
        <title>Cluster manager</title>
        <script type="module" src="main.js" defer></script>
        <link rel="stylesheet" type="text/css" href="main.css" />
    </head>
    <body>
        <section class="section-centred">
            <h1>Clusters Management</h1>
        </section>

        <section class="section-centred">
            <section class="right-container">
                <button id="resyncButton" class="squircle" aria-label="Refresh">ðŸ”„</button>
                <time id="lastClusterSyncDate">(not synced)</time>
            </section>

            <section class="right-container">
                <button id="executeCommandOnTheLowestUtilizedNode">Execute command on the lower utilization</button>
                <button id="joinCluster" command="show-modal" commandfor="nodeJoinDialog">Join node to the cluster</button>
            </section>

            <data-table id="clustersNodes">
                <template shadowrootmode="open">
                    <link rel="stylesheet" type="text/css" href="main.css" />

                    <table>
                        <caption>Clusters</caption>
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Address</th>
                                <th>Tasks</th>
                                <th>Last heartbeat</th>
                                <th>Trip time</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </template>

                <template id="row-template">
                    <tr>
                        <td><!--@ name @--></td>
                        <td><!--@ address @--></td>
                        <td><!--@ tasks @--></td>
                        <td><!--@ last_heartbeat @--></td>
                        <td><!--@ trip_time @--></td>
                        <td><button class="execute-on-node" onclick="$emit('executeOnNode', event)">Execute command</button></td>
                    </tr>
                </template>
            </data-table>

            <section class="section-centred">
                <h3>Node logs</h3>

                <div id="detectedNodes" class="tab-bar" role="tablist">
<!--                    <div class="tab-bar__item">Current node</div>-->
                </div>

                <form>
                    <label>
                        Search logs:
                        <input id="searchLogsField" type="search" placeholder="Search logs" />
                    </label>
                </form>

                <log-list id="currentNodeLogs">
                    <template id="log-template">
                        <li>
                            <span><!--@ processedAt @--></span>
                            <span><!--@ data @--></span>
                        </li>
                    </template>
                </log-list>
            </section>

            <dialog id="nodeJoinDialog">
                <section class="left-container dialog-header">
                    <h3>Join node to the cluster</h3>
                </section>

                <section class="right-container">
                    <button class="dialog__closeBtn" command="close" commandfor="nodeJoinDialog">&times;</button>
                </section>

                <section class="section-centred dialog-content">
                    <form>
                        <div>
                            <label>Node hostname:
                                <input type="text" name="targetHostname"/>
                            </label>

                            <label>Node target port:
                                <input type="text" name="targetPort"/>
                            </label>
                        </div>
                    </form>
                </section>
            </dialog>

            <dialog id="commandExecutionDialog">
                <section class="left-container dialog-header">
                    <h3>Execute command on Cluster</h3>
                </section>

                <section class="right-container">
                    <button class="dialog__closeBtn">&times;</button>
                </section>

                <section class="section-centred dialog-content">
                    <form>
                        <div>
                            <label>Node hostname:
                                <input type="text" name="targetHostname" readonly/>
                            </label>

                            <label>Node target port:
                                <input type="text" name="targetPort" readonly/>
                            </label>

                            <label>How many times to repeat:
                                <input type="number" min="0" max="999999999999999999999999999999999" step="1" name="howManyTimesToRepeat" required/>
                            </label>

                            <label>Command:
                                <input type="text" name="command" required />
                            </label>
                        </div>

                        <div>
                            <label>Runtime type: <select name="runtimeName"></select></label>
                        </div>

                        <div>
                            <button type="submit">Execute command</button>
                        </div>

                        <fieldset>
                            <legend>Result</legend>

                            <strong>Status code:</strong> <span id="execution__statusCode"></span>
                            <br />
                            <div class="copy-snippet">
                                <div class="copy-snippet-header"><strong>Output:</strong></div>
                                <div class="copy-snippet-body">
                                    <pre id="execution__output"></pre>
                                </div>
                            </div>
                        </fieldset>
                    </form>
                </section>
            </dialog>
        </section>
    </body>
</html>
